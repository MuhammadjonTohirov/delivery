{% extends 'base.html' %}
{% load static %}

{% block title %}Manage Menu Items - {{ restaurant.name }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'restaurants/css/menu_management.css' %}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="menu-header">
                <h1>Manage Menu Items</h1>
                <p class="text-muted">Add and manage your restaurant's menu items</p>
                <div class="header-actions">
                    <button class="btn btn-outline-primary" id="bulkActionsBtn">
                        <i class="fas fa-tasks"></i> Bulk Actions
                    </button>
                    <button class="btn btn-primary" id="addItemBtn">
                        <i class="fas fa-plus"></i> Add Menu Item
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters and Search -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="search-container">
                <input type="text" class="form-control" id="searchInput" placeholder="Search menu items...">
                <i class="fas fa-search search-icon"></i>
            </div>
        </div>
        <div class="col-md-3">
            <select class="form-control" id="categoryFilter">
                <option value="">All Categories</option>
                <!-- Categories will be loaded dynamically -->
            </select>
        </div>
        <div class="col-md-3">
            <select class="form-control" id="statusFilter">
                <option value="">All Items</option>
                <option value="available">Available Only</option>
                <option value="unavailable">Unavailable Only</option>
                <option value="featured">Featured Only</option>
            </select>
        </div>
    </div>

    <!-- Menu Items Grid -->
    <div class="row">
        <div class="col-12">
            <div id="menuItemsContainer" class="menu-items-container">
                <div id="menuItemsGrid" class="menu-items-grid">
                    <!-- Menu items will be loaded here dynamically -->
                </div>
                <div id="emptyState" class="empty-state" style="display: none;">
                    <div class="empty-state-content">
                        <i class="fas fa-utensils fa-3x text-muted"></i>
                        <h3>No Menu Items Yet</h3>
                        <p>Start building your menu by adding your first item.</p>
                        <button class="btn btn-primary" onclick="MenuItemManager.showAddForm()">
                            <i class="fas fa-plus"></i> Add Your First Item
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="loading-spinner">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
</div>

<!-- Menu Item Form Modal -->
<div class="modal fade" id="menuItemModal" tabindex="-1" aria-labelledby="menuItemModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="menuItemModalLabel">Add Menu Item</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="menuItemForm" enctype="multipart/form-data">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-3">
                                <label for="itemName" class="form-label">Item Name *</label>
                                <input type="text" class="form-control" id="itemName" name="name" required maxlength="100">
                                <div class="invalid-feedback"></div>
                            </div>
                            <div class="mb-3">
                                <label for="itemDescription" class="form-label">Description</label>
                                <textarea class="form-control" id="itemDescription" name="description" rows="3" maxlength="500"></textarea>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="itemPrice" class="form-label">Price *</label>
                                        <div class="input-group">
                                            <span class="input-group-text">$</span>
                                            <input type="number" class="form-control" id="itemPrice" name="price" step="0.01" min="0" required>
                                        </div>
                                        <div class="invalid-feedback"></div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="itemCategory" class="form-label">Category</label>
                                        <select class="form-control" id="itemCategory" name="category">
                                            <option value="">Select Category</option>
                                            <!-- Categories will be loaded dynamically -->
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="preparationTime" class="form-label">Preparation Time (minutes)</label>
                                <input type="number" class="form-control" id="preparationTime" name="preparation_time" min="1" max="120">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="itemImage" class="form-label">Item Image</label>
                                <div class="image-upload-container">
                                    <input type="file" class="form-control" id="itemImage" name="image" accept="image/*">
                                    <div class="image-preview" id="imagePreview" style="display: none;">
                                        <img src="" alt="Preview" id="previewImg">
                                        <button type="button" class="btn btn-sm btn-danger remove-image" onclick="MenuItemManager.removeImage()">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="isAvailable" name="is_available" checked>
                                    <label class="form-check-label" for="isAvailable">
                                        Available for ordering
                                    </label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="isFeatured" name="is_featured">
                                    <label class="form-check-label" for="isFeatured">
                                        Featured item
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveItemBtn">
                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display: none;"></span>
                    Save Item
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Bulk Actions Modal -->
<div class="modal fade" id="bulkActionsModal" tabindex="-1" aria-labelledby="bulkActionsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="bulkActionsModalLabel">Bulk Actions</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Select items to perform bulk actions:</p>
                <div class="bulk-actions-list">
                    <button class="btn btn-outline-success me-2" onclick="MenuItemManager.bulkUpdateAvailability(true)">
                        <i class="fas fa-check"></i> Make Available
                    </button>
                    <button class="btn btn-outline-warning me-2" onclick="MenuItemManager.bulkUpdateAvailability(false)">
                        <i class="fas fa-times"></i> Make Unavailable
                    </button>
                    <button class="btn btn-outline-danger" onclick="MenuItemManager.bulkDelete()">
                        <i class="fas fa-trash"></i> Delete Selected
                    </button>
                </div>
                <div id="selectedItemsCount" class="mt-3 text-muted">
                    No items selected
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this menu item?</p>
                <p class="text-danger"><strong>Warning:</strong> This action cannot be undone.</p>
                <div id="deleteDetails"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display: none;"></span>
                    Delete Item
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'restaurants/js/menu_management.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        MenuItemManager.init();
    });
</script>
{% endblock %}
